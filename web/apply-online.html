<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<title>How To Become A Teacher</title>
<!-- Reset CSS -->
<link href="css/reset.css" rel="stylesheet" type="text/css">
<!-- Custom Fonts -->
<link href="css/fonts.css" rel="stylesheet" type="text/css">
<!-- Bootstrap -->
<!--<link href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">-->
<!-- Select2 -->
  <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css" rel="stylesheet" type="text/css">
<link href="assets/select2/css/select2.min.css" rel="stylesheet" type="text/css">
<!-- Font Awesome -->
<link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.14.0/css/fontawesome.min.css" rel="stylesheet" type="text/css">
<!-- Iconmoon -->
<link href="assets/iconmoon/css/iconmoon.css" rel="stylesheet" type="text/css">
<!-- Date Picker -->
<!--<link href="assets/datepicker/css/datepicker.css" rel="stylesheet" type="text/css">-->
<!-- Custom Style -->
<link href="css/custom.css" rel="stylesheet" type="text/css">
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
  <style>
    .form-outer input{
      margin-bottom: 0;
    }
    .form-outer .select2.select2-container {
      margin-bottom: 0;
    }
    .form-outer .row div{
      padding-bottom: 30px;
    }
    .form-outer textarea{
      margin-bottom: 0 !important;
    }
  </style>

</head>
<body class="fill-bg"> 


<!-- Start Preloader -->
<div id="loading">
  <div class="element">
    <div class="sk-folding-cube">
      <div class="sk-cube1 sk-cube"></div>
      <div class="sk-cube2 sk-cube"></div>
      <div class="sk-cube4 sk-cube"></div>
      <div class="sk-cube3 sk-cube"></div>
    </div>
  </div>
</div>
<!-- End Preloader -->

<!--Start Form Information Modal-->
<div class="modal fade" id="instruction-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Instruction</h4>
      </div>
      <div class="modal-body">
        abc
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Yes,I have read it.</button>
      </div>
    </div>
  </div>
</div>
<!--End Form Information Modal-->

<!--Start Alert Modal-->
<div class="modal fade" id="alertModal" tabindex="-1" role="dialog" aria-labelledby="alertModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="alertModalLabel">INFO</h4>
      </div>
      <div class="modal-body custom-alert-context">
        abc
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Ok</button>
      </div>
    </div>
  </div>
</div>
<!--End Alert Modal-->

<!-- Start apply online -->
<section class="login-wrapper register">
  <div class="inner">
    <div class="regiter-inner">
      <div class="login-logo"> <a href="index.html"><img src="images/login-logo.png" class="img-responsive" alt=""></a> </div>
      <div class="head-block">
        <h1><strong>How to become a teacher</strong></h1>
      </div>
      <div class="cnt-block">
        <form id="teacher-submit-form" action="/teacherRegister" method="post" class="form-outer">
          <h4 style="margin-bottom: 30px">Input Your Self Information</h4>
          <div class="row">
            <div class="col-sm-6">
              <input onchange="inputCheck(this,checkName)" valid-msg ="  Allowed Name" invalid-msg = "  must be 2 to 254 characters" id="input-name" name="name" type="text" placeholder="Name">
            </div>
            <div class="col-sm-6">
              <input onchange="inputCheck(this,checkAge)" valid-msg="  Allowed Name"  invalid-msg="  must be 0 to 120" id="input-age" name="age" type="text" placeholder="AGE">
            </div>
          </div>
          <div class="row">
            <div class="col-sm-6">
              <input id="input-language"  name="language" type="text" class="hidden" invalid-msg=" Can`t Be Empty" valid-msg=" Allowed Language">
              <select onchange="selectOnchange(this,checkLanguage)" id="select-language" class="custom_select">
                <option value="-1">mother language</option>
              </select>
            </div>
            <div class="col-sm-6">
              <input id="input-second-language" name="second_language" type="text" class="hidden" valid-msg=" Allowed Second Language" invalid-msg=" Can`t Be Empty">
              <select id="select-second-language" class="custom_select" onchange="selectOnchange(this,checkLanguage)">
                <option value="-1">Second Language</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-6">
              <input id="input-country" name="country" type="text" class="hidden" valid-msg=" Allowed" invalid-msg=" Can`t Be Empty">
              <select id="select-country" class="custom_select" onchange="selectOnchange(this,checkCountry)">
                <option value="-1">country</option>
              </select>
            </div>
            <div class="col-sm-6">
                <input id="input-cur-country" name="country_to_live" type="text" class="hidden" valid-msg=" Allowed" invalid-msg=" Can`t Be Empty">
                <select id="select-cur-country" class="custom_select" onchange="selectOnchange(this,checkCountry)">
                <option value="-1">Current country of residence</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-6">
              <input id="input-price" name="price" type="text" placeholder="expect salary per hour(USD)" valid-msg=" Allowed" invalid-msg=" Must Be a number from 0 to 20" onchange="inputCheck(this,checkPrice)">
            </div>
            <div class="col-sm-6">
              <input id="input-gender" name="sex" class="hidden" valid-msg=" Allowed" invalid-msg=" Can`t Be Empty">
              <select id="select-gender" class="custom_select" onchange="selectOnchange(this,checkGender)">
                <option value="-1">gender</option>
                <option value="0">male</option>
                <option value="1">female</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-6">
              <input id="input-education" name="education" type="text" placeholder="University" valid-msg=" Allowed" invalid-msg=" No more than 100 characters or be empty" onchange="inputCheck(this,checkEducation)">
            </div>
            <div class="col-sm-6">
            </div>
          </div>

          <div class="row">
            <div class="col-sm-12">
              <textarea id="input-self-introduction" name="self_introduction" placeholder="self introduction(No more than 1000 characters)" valid-msg=" Allowed" invalid-msg=" Can`t be empty or more than 1000 characters" onchange="inputCheck(this,checkSelfIntroduction)"></textarea>
            </div>
          </div>

<!--          upload picture-->
          <div>
            <h4 style="margin-bottom: 30px">Input your picture</h4>
          </div>
          <div class="row">
            <div>
              <input id="input-pic" name="temp-for-upload" type="file" accept="image/*" valid-msg=" Allowed" invalid-msg=" Can`t Be Empty" onchange="inputCheck(this,checkFile)">
<!--              这个flag恒为true 因为是临时input 不需要判定-->
              <input id="hidden-pic" name ="pic" type="text" class="hidden" check-flag =true>
            </div>
          </div>



<!--          create account-->
          <div>
            <h4 style="margin-bottom: 30px">Create Your Teacher Account</h4>
          </div>

          <div class="row">
            <div class="col-sm-6">
              <input id="input-email" name="email" type="email" placeholder="email" valid-msg=" Allowed" invalid-msg=" Unexpected Email Format" onchange="inputCheck(this,checkEmail)">
            </div>
            <div class="col-sm-3">
              <input id="input-emailCode" name="emailCode" type="text" placeholder="CHECK CODE" valid-msg=" Allowed" invalid-msg=" Unexpected Email Code Format" onchange="inputCheck(this,checkEmailCode)">
            </div>
            <div class="col-sm-3">
              <button style="width: 100%" type="button" onclick="getEmailCode(this)" class="btn" id="btn-get-email-code">GET Check Code</button>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-6">
              <input id="input-teacher-name" name="teacher_name" type="text" placeholder="Account name" valid-msg=" Allowed" invalid-msg=" Unexpected Account Name(6-25 characters)" onchange="inputCheck(this,checkUserName)">
            </div>
            <div class="col-sm-6">
              <input id="input-password" name="password" type="password" placeholder="password" valid-msg=" Allowed" invalid-msg=" Unexpected Password(6-25 characters which must contain letters and numbers)" onchange="inputCheck(this,checkPassword)">
            </div>
          </div>

          <div class="button-outer">
            <button type="button" class="btn" onclick="TeacherRegisterFormSubmit()">Get Started Now <span class="icon-more-icon"></span></button>
          </div>
        </form>

<!--        隐藏的form 用于图片ajax上传-->
        <form enctype="multipart/form-data" id="temp-form"  class="hidden">

        </form>

      </div>
    </div>
  </div>
</section>
<!-- End apply online -->


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) --> 
<script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<!-- Bootsrap JS -->

<script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<!-- Select2 JS --> 
<script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/select2/4.0.3/js/select2.min.js"></script>
<!-- Date Picker JS --> 
<!--<script type="text/javascript" src="assets/datepicker/js/datepicker.js"></script> -->
<!-- Custom JS --> 
<script type="text/javascript" src="js/custom.js"></script>

<script type="text/javascript" src="js/common.js"></script>

<script>
  //init
  // 带json后缀文件请求会自动解析为json obj
  $("#instruction-modal").modal('show');
  $.get("/json/languageCode.json", function (data) {
    for (var i = 0; i < data.length; i++) {
      var name = data[i][1];
      var new_opt = "<option value=\"" + i + "\">" + name + "</option>";
      $("#select-language").append(new_opt);
      $("#select-second-language").append(new_opt);
    }
  })
  $.get("/json/countryCode.json", function (data) {
    for (var i = 0; i < data.length; i++) {
      var name = data[i][1];
      var new_opt = "<option value=\"" + i + "\">" + name + "</option>";
      $("#select-country").append(new_opt);
      $("#select-cur-country").append(new_opt);
    }
  })

  function showEmptyAlert($item) {
    $item.parent().append("<span class='input-check-span'><i style='color: RGB(255,150,0);font-size: 13px;font-weight: bolder' class='glyphicon glyphicon-remove'></i><i style='color: RGB(255,150,0);font-size: 13px;font-weight: bolder'>"+"Please Input"+"</i></span>");
  }
  
  function TeacherRegisterFormSubmit() {
    //字段检查
    var $input_list = $(".form-outer input");
    $input_list.push($(".form-outer textarea")[0]);
    var submit_flag = true;
    for(var i =0;i<$input_list.length;i++){
       var $item = $($input_list[i]);
       if(typeof($item.attr("check-flag"))=="undefined"){
         //存在未填写的内容
         submit_flag = false;
         showEmptyAlert($item);
       }
       else if($item.attr("check-flag")===false){
         submit_flag = false;
       }
    }
    //通过submit
    if(!submit_flag){
      customAlert("Please check your form before submit!");
      return;
    }

    $("#input-pic").clone().appendTo("#temp-form");
    var myFormData = new FormData(document.getElementById("temp-form"));
    $.ajax({
      type: 'post',
      url: "/uploadFile",
      data: myFormData,
      cache: false,
      processData: false,
      contentType: false,
      dataType: "json",
    }).success(function (data) {
        var state = data.state;
        if(state==0){
          customAlert("Upload Picture Fail!Please Check Your Picture Format!")
        }
        else{
          var pic_name = data.append_inf;
          $("#hidden-pic").val(pic_name);

          //使用ajax提交最终表单
          submitFormAfterCheck();
        }
      }).error(function () {
      customAlert("Upload Picture Fail!Please Check Your Network Connection!");
    });

    // 移除temp-input
    $("#temp-form").empty();
  }

  function submitFormAfterCheck() {
    $.ajax({
      type: 'post',
      url: "/teacherRegister",
      data: $("#teacher-submit-form").serialize(),
      dataType: "json",
    }).success(function (data) {
      //返回字段：state： -0 保留  -1 成功注册   -2 字段错误   -3 已存在的教师  -4 未发送过验证码（没有session）-5 验证码不正确/重新发送 -6 图片不符合要求 -7 数据库/服务器故障(不符合长度要求的字段)
      var state = data.state;
      switch (state) {
        case 1:
          customAlert("Success Register");
          break;
        case 2:
          customAlert("Incorrect Input!");
          break;
        case 3:
          customAlert("Account already in existence!");
          break;
        case 4:
          customAlert("Please Click Get Email Code Before Submit Your Form!");
          break;
        case 5:
          customAlert("Incorrect Email Code!Check Your Code Or Resend Email Code!");
          break;
        case 6:
          customAlert("Incorrect Picture Upload");
          break;
        default:
          customAlert("Incorrect Input(too long)");
      }
    }).error(function () {
      customAlert("Submit Form Fail!Please Check Your Network Connection!");
    });
  }
  
  // -0 保留    -1 发送邮件成功    -2 字段错误    -3 请求间隔时间过短    -4 已经绑定过的邮箱    -5 发送邮件失败，检查邮箱格式或者检查邮箱是否存在
  function getEmailCode(me) {
    var email_str = $("#input-email").val()

    if (!checkEmail(email_str)) {
      customAlert("Unexpected Email Format!");
      return;
    }
    $(me).text("Sending...");
    $(me).addClass("disabled");
    $(me).attr("onclick", "null");
    $.post("/teacherSendRegisterEmail", {"email": email_str}, function (data) {
      var state = data.state;
      if (state == 1) {
        customAlert("success send email(If you don`t receive email,check the eamil you have input or resend email. )");
      } else if (state == 2) {
        customAlert("Unexpected Input");
      } else if (state == 3) {
        customAlert("After " + (Math.trunc(60 - data.append_inf / 1000) + " second you can retry!"));
      } else if (state == 4) {
        customAlert("This email is used by other account");
      } else {
        customAlert("Unexpected Email Format");
      }
      $(me).text("GET Check Code");
      $(me).removeClass("disabled");
      $(me).attr("onclick", "getEmailCode(this)");
    }, "json")
  }

  function customAlert(msg) {
    $("#alertModal .custom-alert-context").text(msg);
    $("#alertModal").modal("show");
  }

  function selectOnchange(selectElement,checkFunc) {
    var $select = $(selectElement);
    var value = $select.children("option:selected").val();
    var $input = $select.parent().children("input");
    $input.val(value);
    inputCheck($input[0],checkFunc);
  }
</script>

</body>
</html>