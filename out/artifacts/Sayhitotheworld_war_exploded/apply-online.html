<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<title></title>
<!-- Reset CSS -->
<link href="css/reset.css" rel="stylesheet" type="text/css">
<!-- Custom Fonts -->
<link href="css/fonts.css" rel="stylesheet" type="text/css">
<!-- Bootstrap -->
<link href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<!-- Select2 -->
<link href="assets/select2/css/select2.min.css" rel="stylesheet" type="text/css">
<!-- Font Awesome -->
<link href="assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
<!-- Iconmoon -->
<link href="assets/iconmoon/css/iconmoon.css" rel="stylesheet" type="text/css">
<!-- Date Picker -->
<link href="assets/datepicker/css/datepicker.css" rel="stylesheet" type="text/css">
<!-- Custom Style -->
<link href="css/custom.css" rel="stylesheet" type="text/css">
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->


</head>
<body class="fill-bg"> 


<!-- Start Preloader -->
<div id="loading">
  <div class="element">
    <div class="sk-folding-cube">
      <div class="sk-cube1 sk-cube"></div>
      <div class="sk-cube2 sk-cube"></div>
      <div class="sk-cube4 sk-cube"></div>
      <div class="sk-cube3 sk-cube"></div>
    </div>
  </div>
</div>
<!-- End Preloader --> 
<!-- Start apply online -->
<section class="login-wrapper register">
  <div class="inner">
    <div class="regiter-inner">
      <div class="login-logo"> <a href="index.html"><img src="images/login-logo.png" class="img-responsive" alt=""></a> </div>
      <div class="head-block">
        <h1><strong>How to become a teacher</strong></h1>
      </div>
      <div class="cnt-block">
        <form id="teacher-submit-form" action="/teacherRegister" method="post" class="form-outer">
          <h4 style="margin-bottom: 30px">Input Your Self Information</h4>
          <div class="row">
            <div class="col-sm-6">
              <input id="input-name" name="name" type="text" placeholder="Name">
            </div>
            <div class="col-sm-6">
              <input id="input-age" name="age" type="text" placeholder="AGE">
            </div>
          </div>
          <div class="row">
            <div class="col-sm-6">
              <input id="input-language" name="language" type="text" class="hidden">
              <select id="select-language" class="custom_select">
                <option value="-1">mother language</option>
              </select>
            </div>
            <div class="col-sm-6">
              <input id="input-second-language" name="second_language" type="text" class="hidden">
              <select id="select-second-language" class="custom_select">
                <option value="-1">Second Language</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-6">
              <input id="input-country" name="country" type="text" class="hidden">
              <select id="select-country" class="custom_select">
                <option value="-1">country</option>
              </select>
            </div>
            <div class="col-sm-6">
                <input id="input-cur-country" name="country_to_live" type="text" class="hidden">
                <select id="select-cur-country" class="custom_select">
                <option value="-1">Current country of residence</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-6">
              <input id="input-price" name="price" type="text" placeholder="expect salary per hour(USD)">
            </div>
            <div class="col-sm-6">
              <input id="input-gender" name="sex" class="hidden">
              <select id="select-gender" class="custom_select">
                <option value="-1">gender</option>
                <option value="0">male</option>
                <option value="1">female</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-12">
              <textarea id="input-self-introduction" name="self_introduction" placeholder="self introduction(No more than 1000 characters)"></textarea>
            </div>
          </div>

<!--          upload picture-->
          <div>
            <h4 style="margin-bottom: 30px">Input your picture</h4>
          </div>
          <div class="row">
            <input id="input-pic" name="temp-for-upload" type="file" accept="image/*"/>
            <input id="hidden-pic" name ="pic" type="text" class="hidden">
          </div>



<!--          create account-->
          <div>
            <h4 style="margin-bottom: 30px">Create Your Teacher Account</h4>
          </div>

          <div class="row">
            <div class="col-sm-6">
              <input id="input-email" name="email" type="email" placeholder="email">
            </div>
            <div class="col-sm-3">
              <input id="input-emailCode" name="emailCode" type="text" placeholder="CHECK CODE">
            </div>
            <div class="col-sm-3">
              <button style="width: 100%" type="button" onclick="getEmailCode(this)" class="btn" id="btn-get-email-code">GET Check Code</button>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-6">
              <input id="input-teacher-name" name="teacher_name" type="text" placeholder="Account name">
            </div>
            <div class="col-sm-6">
              <input id="input-password" name="password" type="text" placeholder="password">
            </div>
          </div>

          <div class="button-outer">
            <button type="button" class="btn" onclick="TeacherRegisterFormSubmit()">Get Started Now <span class="icon-more-icon"></span></button>
          </div>
        </form>

<!--        隐藏的form 用于图片ajax上传-->
        <form enctype="multipart/form-data" id="temp-form"  class="hidden">

        </form>

      </div>
    </div>
  </div>
</section>
<!-- End apply online -->


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) --> 
<script type="text/javascript" src="js/jquery.min.js"></script> 
<!-- Bootsrap JS -->

<script type="text/javascript" src="assets/bootstrap/js/bootstrap.min.js"></script>
<!-- Select2 JS --> 
<script type="text/javascript" src="assets/select2/js/select2.min.js"></script>
<!-- Date Picker JS --> 
<script type="text/javascript" src="assets/datepicker/js/datepicker.js"></script> 
<!-- Custom JS --> 
<script type="text/javascript" src="js/custom.js"></script>

<script type="text/javascript" src="js/common.js"></script>

<script>
  //init
  // 带json后缀文件请求会自动解析为json obj
  $.get("/json/languageCode.json", function (data) {
    for (var i = 0; i < data.length; i++) {
      var name = data[i][1];
      var new_opt = "<option value=\"" + i + "\">" + name + "</option>";
      $("#select-language").append(new_opt);
      $("#select-second-language").append(new_opt);
    }
  })
  $.get("/json/countryCode.json", function (data) {
    for (var i = 0; i < data.length; i++) {
      var name = data[i][1];
      var new_opt = "<option value=\"" + i + "\">" + name + "</option>";
      $("#select-country").append(new_opt);
      $("#select-cur-country").append(new_opt);
    }
  })

  function TeacherRegisterFormSubmit() {
    //表单填充
    $("#input-country").val($("#select-country  option:selected").val());
    $("#input-cur-country").val($("#select-cur-country  option:selected").val());
    $("#input-language").val($("#select-language  option:selected").val());
    $("#input-second-language").val($("#select-second-language  option:selected").val());
    $("#input-gender").val($("#select-gender option:selected").val());
    //字段检查
    if(checkName($("#input-name").val())){
      if(checkAge($("#input-age").val())){
        if(checkLanguage($("#input-language").val())){
          if(checkLanguage($("#input-second-language").val())){
            if(checkCountry($("#input-country").val())){
              if(checkCountry($("#input-cur-country").val())){
                if(checkPrice($("#input-price").val())){
                  if(checkGender($("#input-gender").val())){
                    if(checkSelfIntroduction($("#input-self-introduction").val())){
                      if(checkFile($("#input-pic").val())){
                        if(checkUserName($("#input-teacher-name").val())){
                          if(checkPassword($("#input-password").val())){
                            if(checkEmail($("#input-email").val())){
                              if(checkEmailCode($("#input-emailCode").val())){
                                //完成所有检查
                                $("#input-pic").clone().appendTo("#temp-form");
                                var myFormData = new FormData(document.getElementById("temp-form"));
                                $.ajax({
                                  type: 'post',
                                  url: "/uploadFile",
                                  data: myFormData,
                                  cache: false,
                                  processData: false,
                                  contentType: false,
                                  dataType: "json",
                                }).success(function (data) {
                                  console.log(data);
                                  var pic_name = data.append_inf;
                                  $("#hidden-pic").val(pic_name);
                                  // 移除temp-input
                                  $("#temp-form").empty();
                                  $("#teacher-submit-form").submit();
                                }).error(function () {
                                  alert("Upload Picture Fail!");
                                });
                              }
                              else{
                                alertAfterCheck($("#input-emailCode"),"Unexcepted Email Code");
                              }
                            }
                            else{
                              alertAfterCheck($("#input-email"),"Unexcepted Email");
                            }
                          }
                          else{
                            alertAfterCheck($("#input-password"),"Unexcepted Password");
                          }
                        }
                        else{
                          alertAfterCheck($("#input-teacher-name"),"Unexcepted Account Name");
                        }
                      }
                      else {
                        alertAfterCheck($("#input-pic"),"Unexcepted Picture");
                      }
                    }
                    else{
                      alertAfterCheck($("#input-self-introduction"),"Unexcepted Self Introduction");
                    }
                  }
                  else{
                    alertAfterCheck($("#input-gender"),"Unexcepted Gender");
                  }
                }
                else {
                  alertAfterCheck($("#input-price"),"Unexcepted Salary");
                }
              }
              else{
                alertAfterCheck($("#input-cur-country"),"Unexcepted Current Country");
              }
            }
            else{
              alertAfterCheck($("#input-country"),"Unexcepted Country");
            }
          }
          else{
            alertAfterCheck($("#input-second-language"),"Unexcepted Second Language");
          }
        }
        else{
          alertAfterCheck($("#input-language"),"Unexcepted Mother Language");
        }
      }
      else{
        alertAfterCheck($("#input-age"),"Unexcepted Age");
      }
    }
    else{
      alertAfterCheck($("#input-name"),"Unexpected Name");
    }
  }

  // -0 保留    -1 发送邮件成功    -2 字段错误    -3 请求间隔时间过短    -4 已经绑定过的邮箱    -5 发送邮件失败，检查邮箱格式或者检查邮箱是否存在
  function getEmailCode(me) {
    var email_str = $("#input-email").val()

    if (!checkEmail(email_str)) {
      customAlert("Unexpected Email Format!");
      return;
    }
    $(me).text("Sending...");
    $(me).addClass("disabled");
    $(me).attr("onclick", "null");
    $.post("/teacherSendRegisterEmail", {"email": email_str}, function (data) {
      var state = data.state;
      if (state == 1) {
        $(me).text("GET Check Code");
        $(me).removeClass("disabled");
        $(me).attr("onclick", "getEmailCode(this)");
        customAlert("success send email");
      } else if (state == 2) {
        $(me).text("GET Check Code");
        $(me).removeClass("disabled");
        $(me).attr("onclick", "getEmailCode(this)");
        customAlert("Unexpected Input");
      } else if (state == 3) {
        $(me).text("GET Check Code");
        $(me).removeClass("disabled");
        $(me).attr("onclick", "getEmailCode(this)");
        customAlert("After " + (Math.trunc(60 - data.append_inf / 1000) + "second you can retry!"));
      } else if (state == 4) {
        $(me).text("GET Check Code");
        $(me).removeClass("disabled");
        $(me).attr("onclick", "getEmailCode(this)");
        customAlert("This email is used by other account");
      } else {
        $(me).text("GET Check Code");
        $(me).removeClass("disabled");
        $(me).attr("onclick", "getEmailCode(this)");
        customAlert("Unexpected Email Format");
      }
    }, "json")
  }

  function customAlert(msg) {
    window.alert(msg);
  }

  function alertAfterCheck($input,msg) {
    alert(msg);
  }
</script>

</body>
</html>