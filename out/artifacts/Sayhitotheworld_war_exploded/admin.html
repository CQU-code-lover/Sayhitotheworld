<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Admin Page</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="./css/admin.css">
</head>
<body class ="body">
<!--头部导航栏-->
<div class="container-fluid div-head">
    <div style="height: 100%">
        <div id="close-open-control" style="float: left"><img style="height: 40px;position: relative;top:7px;cursor: pointer" src="images/left.png"></div>
        <div style="float:left;height: 100%"><p style="height:100%;text-align:center;font-size: 25px;color: white;position: relative;top: 8px;left: 20px"><span>管理员后台</span></p></div>
        <div class="clear-float"></div>
    </div>
</div>
<!--    防止margin对其后的父元素击穿 使用间隔div代替margin-->
<div class="div-inv"></div>
<div class="div-main" id="div-main">
    <div id="left-nav" class = "l-nav" show="true">
        <ul class="outer-ul">
            <li class="page-link" target-page="#page-1">
                <p><span class="glyphicon glyphicon-user"></span>  管理员个人信息</p>
            </li>
            <li class="page-link" target-page="#page-2">
                <p><span class="glyphicon glyphicon-pencil"></span>  每日统计</p>
            </li>
            <li class="page-link" target-page="#page-3">
                <p><span class="glyphicon glyphicon-globe"></span>  教师信息审核</p>
            </li>
            <li class="page-link" target-page="#page-4">
                <p><span class="glyphicon glyphicon-comment"></span>  教师信息修改审核</p>
            </li>
            <li class="inner-li" target-ul="#ul-2">
                <p><span class="glyphicon glyphicon-user"></span>  用户管理</p>
            </li>
            <ul id="ul-2" class="inner-ul">
                <li class="page-link" target-page="#page-5"><p>用户信息</p></li>
                <li class="page-link" target-page="#page-6"><p>用户禁用</p></li>
                <li class="page-link" target-page="#page-7"><p>黑名单</p></li>
            </ul>
            <li class="page-link" target-page="#page-8">
                <p><span class="glyphicon glyphicon-list-alt"></span>  公告发布</p>
            </li>
            <li class="inner-li" target-ul="#ul-5" id="super_user_li">
                <p><span class="glyphicon glyphicon-lock"></span>  超级管理员选项</p>
            </li>
            <ul id="ul-5" class="inner-ul">
                <li class="page-link" target-page="#page-9"><p>内部兑换码</p></li>
                <li class="page-link" target-page="#page-10"><p>教师信息修改</p></li>
                <li class="page-link" target-page="#page-11"><p>普通管理员注册</p></li>
                <li class="page-link" target-page="#page-12"><p>普通管理员设置</p></li>
            </ul>
        </ul>
    </div>
    <div id="right-context" class="r-context">
        <div class="container-fluid" id="context-head">
            <p><span class="glyphicon glyphicon-home"></span>  主页</p>
            <div class="clear-float"></div>
        </div>
        <div id="context-container">
            <div class="page page-active" id="page-1">
                <div id="page-1-head-welcome" class="hidden-xs">
                    <p></p>
                </div>
                <div class="panel panel-default context-inner-div">
                    <div class="panel-heading panel-title">管理员信息</div>
                    <div class="panel-body">
                        <div class="list-group edit-list">
                            <a href="#" class="list-group-item">
                                <h4 class="list-group-item-heading">用户名</h4>
                                <p class="list-group-item-text" id="admin_name"></p>
                            </a>
                            <a href="#" class="list-group-item">
                                <h4 class="list-group-item-heading">权限级</h4>
                                <p class="list-group-item-text" id="level"></p>
                            </a>
                            <a href="#" class="list-group-item">
                                <h4 class="list-group-item-heading">注册时间</h4>
                                <p class="list-group-item-text" id="registe_time"></p>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="page" id="page-2">
                <div class="panel panel-default context-inner-div">
                    <h1>暂未开放</h1>
                </div>
            </div>


<!--            教师信息审核页面~-->
            <div class="page" id="page-3">
<!--                <div class="panel panel-primary context-inner-div">-->
<!--                    <div class="panel-heading panel-title">计算机科普活动</div>-->
<!--                    <div class="panel-body">在6月31日下午5点，计算机协会将会在D1213举行计算机科普活动，让大家能够了解计算机相关的知识，欢迎大家来参加本次活动~</div>-->
<!--                    <div class="panel-footer"><p>发布时间：2020-7-1      社团id:2      社团名称:计算机协会</p></div>-->
<!--                    <div style="margin: 15px"><button class="btn btn-primary">同意</button><span>                      </span><button class="btn btn-danger">拒绝</button></div>-->
<!--                </div>-->

<!--                <div class="panel panel-primary context-inner-div">-->
<!--                    <div class="panel-heading panel-title">测试标题</div>-->
<!--                    <div class="panel-body">在这里填写活动内容</div>-->
<!--                    <div class="panel-footer"><p>发布时间：2020-7-1      社团id:1      社团名称：测试社团</p></div>-->
<!--                    <div style="margin: 15px"><button class="btn btn-primary">同意</button><span>                      </span><button class="btn btn-danger">拒绝</button></div>-->
<!--                </div>-->
<!--                <div style="text-align: center">-->
<!--                    暂无更多-->
<!--                </div>-->
            </div>

            <div class="page" id="page-4">
                <div class="panel panel-success context-inner-div"  id="b">
                    <h1>暂未开放</h1>
                </div>
            </div>
    </div>
    <div class = "clear-float"></div>
</div>
</body>
</html>
<script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>
    $(document).ready(init);
    function init() {
        var window_width = $(window).width();
        if(window_width<768) {       //小屏幕
            $("#left-nav").css("left", "-285px");
            $("#left-nav").attr("show", "false");
        }
        setContextWidth();
        $("#close-open-control").click(animator_toggle_nav);
        $(window).resize(setContextWidth);
        $(".outer-ul>li").on("click",click_li_active);
        $(".outer-ul>li.inner-li").on("click",click_li_toggle);
        $("#context-head>p").click(function () {
            window.location="/mainPage.html";
        })
        initPage();
        //为每个page绑定事件
        pageBindClick();
        $("#page2-form>button").off("click").on("click",page_2_form_submit);
    }

    //输出字段： state：  - 0 保留     -1 成功     -2 未登录
    //         data:
    function initPage() {
        //首先检查权限
        $.ajax({
            type: 'post',
            url: "/adminBasicInformation",
            dataType: "json",
        }).done(function (data) {
            var state = data.state;
            switch (state) {
                case 1:
                    //成功
                    $("#admin_name").text(data.admin_name);
                    $("#page-1-head-welcome>p").text("欢迎管理员 ："+data.admin_name);
                    $("#level").text(function () {
                         var type = data.type;
                         if(type===0){
                             return "超级管理员";
                         }
                         else{
                             return "普通管理员";
                         }
                    });
                    $("#registe_time").text(getData(data.create_time));
                    // //进行一些界面的控制 某些情况不能够被展开
                    if(data.type!==0){
                         $("#super_user_li").css("display","none");
                    }
                    break;
                case 2:
                    console.log("未登录！");
                    window.location.href = "/adminLogin.html";
                    break;
                default:
                    console.log("未知错误！");
            }
        }).fail(function (data) {
            console.log("网络连接错误！");
        })
    }
    function getData(str) {
        if(str === undefined){
            return "1970-9-9";
        }
        var date = new Date(parseInt(str));
        return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDay();
    }
    function setContextWidth() {
        // var nav_height = window.innerHeight
        //     || document.documentElement.clientHeight
        //     || document.body.clientHeight;
        var nav_height = $(window).height();
        $("#left-nav").css("height",nav_height+"px");

        var jq_left_nav = $("#left-nav");
        var jq_div_main = $("#div-main");
        var width_par;
        if(jq_left_nav.attr("show")==="true") {
            width_par= jq_div_main.width() - jq_left_nav.width();
        }
        else{
            width_par= jq_div_main.width();
        }
        $("#right-context").css("width",width_par+"px");
    }
    function animator_toggle_nav() {
        if($("#left-nav").attr("show")==="true") {
            $("#left-nav").animate({left: "-285px"}, {duration: 500, queue: false});
            $("#right-context").animate({width: $("#right-context").width() + 285 + "px"}, {duration: 500, queue: false});
            $("#left-nav").attr("show", "false");
        }
        else{
            $("#left-nav").animate({left:"0"},{duration:500,queue:false});
            $("#right-context").animate({width:$("#right-context").width()-285+"px"},{duration:500,queue:false});
            $("#left-nav").attr("show","true");
        }
    }
    function click_li_active() {
        $(this).siblings().removeClass("active");
        $(this).addClass("active");
    }
    function click_li_toggle() {
        var target = $(this).attr("target-ul");
        $(target).slideToggle("slow");
    }
    function pageBindClick() {
        $(".page-link").on("click",function () {
            var target_page = $($(this).attr("target-page"));
            if(target_page.hasClass("page-active")){
                //do nothing
            }
            else{
                $(".page").removeClass("page-active");
                target_page.addClass("page-active");
                setContextWidth();
            }
        });
    }
    function page_2_form_submit() {
        var title = $("#page2-form-title");
        var text = $("#page2-form-text");
        var result = true;
        if(title.val().length>20||title.val().length===0){
            $("#page2-form-title-warn").show();
            result=false;
        }
        if (text.val().length>200||text.val().length===0){
            $("#page2-form-text-warn").show();
            result=false;
        }
        if(result){
            $.post("/adminNoticeSubmit",{
                "title":title.val(),
                "text":text.val(),
            },function (data,status) {
                if(data=="1"){
                    alert("提交成功！");
                }
                else if(data=="0"){
                    alert("没有合法的提交权限");
                    window.location = "/adminLogin";
                }
                else if(data=="2"){
                    alert("不要使用脚本提交或者修改js文件，好吗？");
                }
                else{
                    alert("服务器故障");
                }
            });
        }
    }
    $("#yes").on("click",function () {
        alert("已提交审核！");
        $("#b").hide();
    })
</script>